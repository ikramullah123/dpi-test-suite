<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>YAF - Documentation</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

        <link rel="stylesheet" type="text/css" href="../../site/style.css" />
        <link rel="stylesheet" type="text/css" href="doxygen.css">
        <link rel="stylesheet" type="text/css" href="tabs.css">
</head>
<body>
    <div id="p-body">
      <div id="l-header">
        <img src="../../site/sei-logo.png" id="l-sei-logo"
            alt="Software Engineering Institute | Carnegie Mellon&copy;" />
        <div id="l-netsa-logo"><a id="l-netsa-name" href="../../index.html"><b>CERT NetSA Security Suite</b></a></div>
        <div id="l-netsa-motto">Monitoring for Large-Scale Networks</div>
        <h1 class="l-page-title">YAF</h1>
        <span id="l-subtitle">Documentation</span>
      </div><!-- l-header -->
      <div id="l-content">
        <div id="l-sidebar">
          <div class="p-sidebar-section">
            <h1><a href="index.html">YAF</a></h1>
            <ul>
              <li><a href="../docs.html">Documentation</a></li>
              <li><a href="../download.html">Downloads</a></li>
            </ul>
          </div><!-- p-sidebar-section -->
        </div><!-- l-sidebar -->
<!-- Generated by Doxygen 1.6.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>yafrag.h File Reference</h1>
<p>Fragment reassembly interface for YAF.  
<a href="#_details">More...</a></p>
<code>#include &lt;yaf/autoinc.h&gt;</code><br/>
<code>#include &lt;yaf/decode.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="yafcore_8h_source.html">yaf/yafcore.h</a>&gt;</code><br/>

<p><a href="yafrag_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct yfFragTab_st&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A fragment table.  <a href="#a6ef93bd756b0c8af4dc659f47ed1ffa4"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#a8fe95d0ea69b3f93130778cd864fc86b">yfFragTabAlloc</a> (uint32_t idle_ms, uint32_t max_frags, uint32_t max_payload)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate a fragment table.  <a href="#a8fe95d0ea69b3f93130778cd864fc86b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#a21beb6d36cdeba13f7c3d90dd9c0b821">yfFragTabFree</a> (<a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *fragtab)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free a fragment table.  <a href="#a21beb6d36cdeba13f7c3d90dd9c0b821"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#acf4a0fa912ab55a8d8a4250c072cba16">yfDefragPBuf</a> (<a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *fragtab, <a class="el" href="structyf_i_p_frag_info__st.html">yfIPFragInfo_t</a> *fraginfo, size_t pbuflen, <a class="el" href="structyf_p_buf__st.html">yfPBuf_t</a> *pbuf, const uint8_t *pkt, size_t hdr_len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Defragment a fragment returned by yfDecodeToPBuf().  <a href="#acf4a0fa912ab55a8d8a4250c072cba16"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#a2c8a3400f13eee32f74a1c68da42e518">yfFragDumpStats</a> (<a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *fragtab, uint64_t packetTotal)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Print fragment reassembler statistics to the log.  <a href="#a2c8a3400f13eee32f74a1c68da42e518"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#af74e0b96af9259920f0a1653bb266f9e">yfGetFragTabStats</a> (<a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *fragtab, uint32_t *dropped, uint32_t *assembled)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get Frag Stats to yfWriteStatsFlow for Stats Export.  <a href="#af74e0b96af9259920f0a1653bb266f9e"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Fragment reassembly interface for YAF. </p>
<p>[TODO - new frontmatter]</p>
<p>This facility is used by the YAF flow generator. </p>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a6ef93bd756b0c8af4dc659f47ed1ffa4"></a><!-- doxytag: member="yafrag.h::yfFragTab_t" ref="a6ef93bd756b0c8af4dc659f47ed1ffa4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct yfFragTab_st <a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A fragment table. </p>
<p>Opaque. Create with <a class="el" href="yafrag_8h.html#a8fe95d0ea69b3f93130778cd864fc86b" title="Allocate a fragment table.">yfFragTabAlloc()</a> and free with <a class="el" href="yafrag_8h.html#a21beb6d36cdeba13f7c3d90dd9c0b821" title="Free a fragment table.">yfFragTabFree()</a>. </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="acf4a0fa912ab55a8d8a4250c072cba16"></a><!-- doxytag: member="yafrag.h::yfDefragPBuf" ref="acf4a0fa912ab55a8d8a4250c072cba16" args="(yfFragTab_t *fragtab, yfIPFragInfo_t *fraginfo, size_t pbuflen, yfPBuf_t *pbuf, const uint8_t *pkt, size_t hdr_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean yfDefragPBuf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *&nbsp;</td>
          <td class="paramname"> <em>fragtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structyf_i_p_frag_info__st.html">yfIPFragInfo_t</a> *&nbsp;</td>
          <td class="paramname"> <em>fraginfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>pbuflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structyf_p_buf__st.html">yfPBuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>pbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>hdr_len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Defragment a fragment returned by yfDecodeToPBuf(). </p>
<p>This adds the fragment to the given fragment table. If the fragment completes a fragmented packet, copies the assembled packet into the given pbuf, overwriting it, and returns TRUE. If the packet is not fragmented (that is, if fraginfo-&gt;frag is 0), has no effect and returns TRUE.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fragtab</em>&nbsp;</td><td>fragment table to add fragment to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fraginfo</em>&nbsp;</td><td>fragment information structure filled in by yfDecodeToPBuf() </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pbuflen</em>&nbsp;</td><td>size of the packet buffer pbuf </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pbuf</em>&nbsp;</td><td>packet buffer. On call, contains decoded fragmented packet to add to the fragment table. If this call returns TRUE, on return, contains assembled packet. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pkt</em>&nbsp;</td><td>pkt buffer from libpcap. We need this to reassemble (memcpy) TCP header fragments when payload is not enabled. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdr_len</em>&nbsp;</td><td>size of the packet buffer pkt </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>TRUE if pbuf is valid and contains an assembled packet, FALSE otherwise. </dd></dl>

</div>
</div>
<a class="anchor" id="a2c8a3400f13eee32f74a1c68da42e518"></a><!-- doxytag: member="yafrag.h::yfFragDumpStats" ref="a2c8a3400f13eee32f74a1c68da42e518" args="(yfFragTab_t *fragtab, uint64_t packetTotal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void yfFragDumpStats </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *&nbsp;</td>
          <td class="paramname"> <em>fragtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>packetTotal</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print fragment reassembler statistics to the log. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fragtab</em>&nbsp;</td><td>fragment table to dump stats for </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>packetTotal</em>&nbsp;</td><td>total number of packets observed </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a8fe95d0ea69b3f93130778cd864fc86b"></a><!-- doxytag: member="yafrag.h::yfFragTabAlloc" ref="a8fe95d0ea69b3f93130778cd864fc86b" args="(uint32_t idle_ms, uint32_t max_frags, uint32_t max_payload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a>* yfFragTabAlloc </td>
          <td>(</td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>idle_ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>max_frags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>max_payload</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate a fragment table. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>idle_ms</em>&nbsp;</td><td>idle timeout in milliseconds. A fragmented packet for which no fragments are received over an idle timeout is dropped. Most host IPv4 implementations use 30 seconds (30000); it is recommended to use the same here. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>max_frags</em>&nbsp;</td><td>maximum number of unreassembled fragmented packets. Fragmented packets exceeding this limit will be dropped in least-recent order. Used to limit resource usage of a fragment table. A value of 0 disables fragment count limits. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>max_payload</em>&nbsp;</td><td>maximum octets of payload to capture per fragmented packet. A value of 0 disables payload reassembly.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a new fragment table. </dd></dl>

</div>
</div>
<a class="anchor" id="a21beb6d36cdeba13f7c3d90dd9c0b821"></a><!-- doxytag: member="yafrag.h::yfFragTabFree" ref="a21beb6d36cdeba13f7c3d90dd9c0b821" args="(yfFragTab_t *fragtab)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void yfFragTabFree </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *&nbsp;</td>
          <td class="paramname"> <em>fragtab</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free a fragment table. </p>
<p>Discards any outstanding fragmented packets within.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fragtab</em>&nbsp;</td><td>a fragment table. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="af74e0b96af9259920f0a1653bb266f9e"></a><!-- doxytag: member="yafrag.h::yfGetFragTabStats" ref="af74e0b96af9259920f0a1653bb266f9e" args="(yfFragTab_t *fragtab, uint32_t *dropped, uint32_t *assembled)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void yfGetFragTabStats </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *&nbsp;</td>
          <td class="paramname"> <em>fragtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&nbsp;</td>
          <td class="paramname"> <em>dropped</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&nbsp;</td>
          <td class="paramname"> <em>assembled</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get Frag Stats to yfWriteStatsFlow for Stats Export. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fragtab</em>&nbsp;</td><td>pointer to fragmentation table </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dropped</em>&nbsp;</td><td>number of expired fragments </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>assembled</em>&nbsp;</td><td>number of assembled packets </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div>
      </div><!-- l-content -->
      <div id="l-footer">&copy; 2006-2013 Carnegie Mellon University</div>
    </div><!-- p-body -->
</body>
</html>   
